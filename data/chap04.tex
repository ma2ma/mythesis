
\chapter{系统实现}
\label{chap:achieve}

上文介绍了本系统的系统架构和逻辑功能。本章我们将进行部分的系统功能实现。由于本系统结构庞大，功能复杂，涉及许多不同体系的技术，所以限于篇幅有限，我们并不打算把系统涉及到的全部实现细节一一介绍。而只介绍其中最核心的，和最具有代表性的部分。

由于基于\smarkdown的文档撰写是本系统区别其他网络文档管理平台的最大特点。而且由于\smarkdown语法是本文作者在Markdown语法基础上扩展而来。所以介绍\smarkdown语法和它如何被渲染展示和如何被转换成\LaTeX,再进一步转换成最终的PDF文档将是我们本章介绍的重点。

由于Restful api是本系统的核心架构，所以api的实现也将是本章重点介绍的内容。

但是在介绍这两个部分之前，我们还是先来了解一下本系统主要涉及的技术，以及用到的编程语言，框架，和组件。

\section{系统涉及的实现技术}
\label{sec:language}

本系统要实现的功能繁多，而且要运行的平台也多样\footnote{windows应用,ios app,andriod app,web应用等}。最粗略的统计，主要包括：web service服务端、数据库、web前端、windows客户端和移动客户端几个部分。下面分别进行介绍：

\subsection{web service服务端}
\label{sec:webservice}

上文介绍过，本系统基本架构为restful的web服务。目前支持restful的编程语言和成型的开源架构很多，比如ROR、Python、java、.net等等。本系统选择的后端开发框架为Ruby on Rails,官方简称Rails，非RoR。它是使用Ruby脚本语言\footnote{一种为简单快捷面向对象编程而创的脚本语言，在20世纪90年代由日本人松本行弘开发。}所开发的Web开发框架。Rails是一套专业的开发框架，采用了MVC(Model-View-Control)模式、原生支持单元测试和整体测试、支持Ajax和RESTful结构、ORM机制，以及支持各种最新的业界标准像是HTML5、JQuery等等功能。它的发明人是David Heinemeier Hanson(DHH)，DHH是2004年将Rails从37signals商业产品中独立出来的开源项目。它的设计目标是只要开发者熟悉它的惯例，就可以快速的开发网站。相比其他的语言和框架，Rails可以让你用更少的编码实现更多的功能。

选择Ruby on Rails的重要原因是：
\begin{itemize}
\item 它对RESTful的支持较好。可以说是原生支持，不用做任何配置就可以构建RESTful的web。
\item 支持多种格式的信息返回，一个后台服务可以支持web段程序，也可以提供api给其他客户端程序使用。
\item 采用它后生产力的暴增，写的的应用程序，增加新的功能都很容易。可以用更少的程序做更多的事情，而且程序维护起来更加容易。
\end{itemize}

当然Rails只是后台服务的基础架构，要完成本系统的诸多负载功能，还需要利用许多开源组件。

\subsection{数据库}
\label{sec:database}

本系统在数据库的使用上与传统的信息管理系统不同，我们将使用传统关系型数据库和非关系型数据库（nosql）相结合的方法。关系型数据库我们将使用开源的数据库mysql。关于这个数据库这里不过多的介绍，它是目前业界最常使用的开源关系型数据库系统。关于nosql,下面简单的做一个介绍。

nosql的主要特点包括非关系型、分布式、开源、水平可扩展。第一次看到这个名字，很多人都会认为nosql是“no sql”的简写，所以认为它是sql数据库的替代品，但实际上它是“not only sql”的简写，意思是不止用sql。它的出现主要是弥补关系型数据库的诸多缺点和不足：
\begin{enumerate}
\item 不擅长处理大量数据并发写入的应用。这也是近年来对关系型数据库的最大的诟病，因为通过增加硬件规模和性能来提高数据库读性能，但是由于数据一致性问题想提高写入性能会非常麻烦。进入web2.0时代，关系型数据库应对大量的SNS类型的动态网站时已经显得力不从心。
\item 不擅长处理字段不固定的应用。如果字段不固定，使用关系型数据库非常麻烦，尤其是目前主流的开发框架都使用数据库映射功能（ORM），如果字段不固定，那么开发的难度将非常大。
\end{enumerate}
而nosql数据库则可以很好的解决以上的问题：
\begin{enumerate}
\item nosql易于数据分散，可以通过简单的横向扩展来提高系统性能，而且读写性能均可以通过增加硬件规模和性能来得到线性的提升。
\item nosql可以轻松应对字段不固定的应用。
\end{enumerate}
通过第三章的介绍，我们知道，我们的系统既是一个高并发写入的SNS类的应用，同时也是一个字段不固定的应用。所以同时使用关系型数据库和nosql将很好的解决系统数据存储的问题。


目前常用的nosql数据库大致分为四种：
\begin{enumerate}
\item Key-value stores键值存储, memcached、Tokyo Tyrant、Redis等数据库属于这种类型。
\item Table-oriented 面向表, 主要代表有Google的BigTable和Cassandra。
\item Document-oriented面向文档,最常用的MongoDB 和 CouchDB。
\item Graph-oriented 面向图论， 如Neo4J。
\end{enumerate}
我们系统主要是用的是MongoDB这个面向文档的数据库。一方面，它是目前业界最广泛使用的nosql数据库。另外一方面，它面向文档的数据结构可以不用第一表结构，也支持复杂的查询条件，比较吻合本系统的需求。
